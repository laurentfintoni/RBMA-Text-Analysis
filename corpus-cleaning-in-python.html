<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Part 3 Corpus Cleaning in Python | Red Bull Music Academy Lectures: Text Analysis and Topic Modeling</title>
  <meta name="description" content="Exploring the RBMA lectures archive using text analysis and mining, a project for the Digital Text in the Humanities course at the university of Bologna, 2020/2021." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Part 3 Corpus Cleaning in Python | Red Bull Music Academy Lectures: Text Analysis and Topic Modeling" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/images/rbmacover.jpg" />
  <meta property="og:description" content="Exploring the RBMA lectures archive using text analysis and mining, a project for the Digital Text in the Humanities course at the university of Bologna, 2020/2021." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Part 3 Corpus Cleaning in Python | Red Bull Music Academy Lectures: Text Analysis and Topic Modeling" />
  
  <meta name="twitter:description" content="Exploring the RBMA lectures archive using text analysis and mining, a project for the Digital Text in the Humanities course at the university of Bologna, 2020/2021." />
  <meta name="twitter:image" content="/images/rbmacover.jpg" />

<meta name="author" content="Laurent Fintoni" />


<meta name="date" content="2021-09-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="corpus-cleaning-in-r.html"/>
<link rel="next" href="exploratory-analysis-in-python.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">RBMA Lectures: Text Analysis and Topic Modeling</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#pre-processing-steps"><i class="fa fa-check"></i><b>1.1</b> Pre-Processing Steps</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="corpus-cleaning-in-r.html"><a href="corpus-cleaning-in-r.html"><i class="fa fa-check"></i><b>2</b> Corpus Cleaning in R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="corpus-cleaning-in-r.html"><a href="corpus-cleaning-in-r.html#basic-cleaning"><i class="fa fa-check"></i><b>2.1</b> Basic cleaning</a></li>
<li class="chapter" data-level="2.2" data-path="corpus-cleaning-in-r.html"><a href="corpus-cleaning-in-r.html#lemmatizing-vs-stemming"><i class="fa fa-check"></i><b>2.2</b> Lemmatizing vs Stemming</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="corpus-cleaning-in-python.html"><a href="corpus-cleaning-in-python.html"><i class="fa fa-check"></i><b>3</b> Corpus Cleaning in Python</a>
<ul>
<li class="chapter" data-level="3.1" data-path="corpus-cleaning-in-python.html"><a href="corpus-cleaning-in-python.html#basic-cleaning-pt-2"><i class="fa fa-check"></i><b>3.1</b> Basic cleaning pt 2</a></li>
<li class="chapter" data-level="3.2" data-path="corpus-cleaning-in-python.html"><a href="corpus-cleaning-in-python.html#lemmatizing-vs-stemming-pt-2"><i class="fa fa-check"></i><b>3.2</b> Lemmatizing vs Stemming pt 2</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exploratory-analysis-in-python.html"><a href="exploratory-analysis-in-python.html"><i class="fa fa-check"></i><b>4</b> Exploratory Analysis in Python</a>
<ul>
<li class="chapter" data-level="4.1" data-path="exploratory-analysis-in-python.html"><a href="exploratory-analysis-in-python.html#pos-visualisation"><i class="fa fa-check"></i><b>4.1</b> POS Visualisation</a></li>
<li class="chapter" data-level="4.2" data-path="exploratory-analysis-in-python.html"><a href="exploratory-analysis-in-python.html#lexical-diversity"><i class="fa fa-check"></i><b>4.2</b> Lexical diversity</a></li>
<li class="chapter" data-level="4.3" data-path="exploratory-analysis-in-python.html"><a href="exploratory-analysis-in-python.html#most-common-words"><i class="fa fa-check"></i><b>4.3</b> Most Common Words</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exploratory-analysis-in-r.html"><a href="exploratory-analysis-in-r.html"><i class="fa fa-check"></i><b>5</b> Exploratory Analysis in R</a>
<ul>
<li class="chapter" data-level="5.1" data-path="exploratory-analysis-in-r.html"><a href="exploratory-analysis-in-r.html#co-occurences"><i class="fa fa-check"></i><b>5.1</b> Co-occurences</a></li>
<li class="chapter" data-level="5.2" data-path="exploratory-analysis-in-r.html"><a href="exploratory-analysis-in-r.html#term-frequency-vs-inverse-document-frequency"><i class="fa fa-check"></i><b>5.2</b> Term Frequency vs Inverse Document Frequency</a></li>
<li class="chapter" data-level="5.3" data-path="exploratory-analysis-in-r.html"><a href="exploratory-analysis-in-r.html#collocations"><i class="fa fa-check"></i><b>5.3</b> Collocations</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="topic-modeling.html"><a href="topic-modeling.html"><i class="fa fa-check"></i><b>6</b> Topic Modeling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="topic-modeling.html"><a href="topic-modeling.html#topic-modeling-in-r"><i class="fa fa-check"></i><b>6.1</b> Topic Modeling in R</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="topic-modeling.html"><a href="topic-modeling.html#topic-modeling-with-topicmodels"><i class="fa fa-check"></i><b>6.1.1</b> Topic Modeling with topicmodels</a></li>
<li class="chapter" data-level="6.1.2" data-path="topic-modeling.html"><a href="topic-modeling.html#topic-modeling-with-stm"><i class="fa fa-check"></i><b>6.1.2</b> Topic Modeling with stm</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="topic-modeling.html"><a href="topic-modeling.html#topic-modeling-in-python"><i class="fa fa-check"></i><b>6.2</b> Topic Modeling in Python</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>7</b> Conclusion</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Red Bull Music Academy Lectures: Text Analysis and Topic Modeling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="corpus-cleaning-in-python" class="section level1" number="3">
<h1><span class="header-section-number">Part 3</span> Corpus Cleaning in Python</h1>
<div id="basic-cleaning-pt-2" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Basic cleaning pt 2</h2>
<p>After cleaning the corpus with R, I attempted to replicate the process in Python both as a learning exercise and to see what might be different. For Python I focused on using the nltk library<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>, which seems to be equivalent in popularity to R’s tm package.</p>
<p>Here are the main steps and takeaways from the process:</p>
<ol style="list-style-type: decimal">
<li><p>Regular expressions are essential to doing ‘better’ cleaning in Python and after a lot of trial and error attempting to devise various patterns to do what I wanted I got some help from a friend to focus on a simple pattern that could strip each document of the lecturer or host’s name when it appears on its own line rather than throughout the text. I settled on this as a small win and a primary point of difference between the Python and R cleaning processes. In R, I removed lecturer/host names from the entire corpus, even when someone might be mentioned in another lecture, which could be an issue for any meaningful attempts at creating networks between people (the repeated use of names throughout each file is also a huge noise factor for any textual analysis). With this regex pattern I was able to remove the instances of names that are pure noise.</p></li>
<li><p>Another major difference between Python and R that emerged through this comparison was in the ease of processing stopwords. R allows for the inclusion of n-grams in a stopword list, whereas in Python this needs to be done with additional code. I tried a few regex solutions but was unable to get something working to capture anything more than unigrams. This ended up being another difference between the two versions. In Python I broke down all the stopwords into unigrams. The primary issue with this is that one of the custom stopwords is “Red Bull Music Academy,” which ended up removing the word “music” from the Python version of the corpus, which as we’ll see is one of the most prominent words in the corpus.</p></li>
</ol>
<p>Below are cells showing the code I used for the cleaning and some relevant outputs.</p>
<p>Note that to avoid running unnecessary code during the output of the notebooks, Python functions are shown as plain code with their outputs as images, code chunks are only used and output when they required minimal processing.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="corpus-cleaning-in-python.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="corpus-cleaning-in-python.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#import needed libraries</span></span>
<span id="cb15-2"><a href="corpus-cleaning-in-python.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb15-3"><a href="corpus-cleaning-in-python.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb15-4"><a href="corpus-cleaning-in-python.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> PlaintextCorpusReader, wordnet</span></code></pre></div>
<pre><code>import re
import os.path
from nltk.tokenize import word_tokenize
from nltk.stem import WordNetLemmatizer
from nltk.tokenize.treebank import TreebankWordDetokenizer</code></pre>
<pre><code>#set raw corpus to be cleaned
rbma_corpus = PlaintextCorpusReader(&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/rbma-lectures-master/data_no_empty_files_new_file_names_no_intro&#39;, &#39;.*\.txt&#39;)
#load custom stoplist as df 
lecturer_names_df = pd.read_csv(&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/rbma_stop_words_2.csv&#39;)
#set export directories
export_directory = &#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_V1&#39;
export_directory_two = &#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_V2&#39;
export_directory_three = &#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_LEMM_V1&#39;
export_directory_four = &#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_LEMM_V2&#39;
export_directory_five = &#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_LEMM_V1_POS&#39;
export_directory_six = &#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_LEMM_V2_POS&#39;</code></pre>
<pre><code>#clean each doc in corpus of punct, standard stopwords, custom stopwords and lecturer/interviewer names (only on new lines)
def filter_stop_punct(input_string):
    stopwords = nltk.corpus.stopwords.words(&#39;english&#39;) #nltk stopwords 
    custom_stopwords = [&#39;red&#39;, &#39;bull&#39;, &#39;music&#39;, &#39;academy&#39;, &#39;yeah&#39;, &#39;like&#39;, &#39;applause&#39;, &#39;laughs&#39;, &#39;really&#39;, &#39;rbma&#39;, &#39;kinda&#39;, &#39;audience&#39;, &#39;member&#39;,  &#39;just&#39;, &#39;can&#39;, &#39;going&#39;, &#39;get&#39;, &#39;got&#39;, &#39;something&#39;, &#39;lot&#39;, &#39;thing&#39;, &#39;get&#39;, &#39;things&#39;, &#39;one&#39;, &#39;kind&#39;, &#39;stuff&#39;, &#39;know&#39;, &#39;want&#39;, &#39;well&#39;] #list of custom stopwords 
    lecturer_names = lecturer_names_df[&#39;RBMA stop words&#39;].tolist() #import lecturer/host names 
    cleaning_regex = re.compile(&#39;\n\s*(&#39; + &#39;|&#39;.join(lecturer_names) + &#39;)\s*\n&#39;) #cleaning pattern for names 
    punct_tokenizer = nltk.RegexpTokenizer(r&quot;\w+&quot;) #catch punct at tokenizing stage 
    newline_string = &#39;\n&#39; + input_string #add a new line to catch first mention of lecturer/host
    text_lower = newline_string.lower() #lower everything 
    text_clean = re.sub(cleaning_regex, &#39;\n&#39;, text_lower) #remove names on their own line only
    text_tokenised = punct_tokenizer.tokenize(text_clean) #tokenize string
    text_clean = [w for w in text_tokenised if w not in stopwords] #remove stopwords
    text_clean_2 = [w for w in text_clean if w not in custom_stopwords] #remove custom stopwords 
    text_clean_3 = TreebankWordDetokenizer().detokenize(text_clean_2) #detokenize to get clean string back 
    text_clean_4 = re.sub(&#39;’|‘|–|“|”|…|—|dâm funk&#39;, &#39;&#39;, text_clean_3) # catch loose bits
    text_clean_5 = re.sub(r&#39;\d+&#39;, &#39;&#39;, text_clean_4) #remove numbers
    text_clean_6 = re.sub(r&#39;\ss\s&#39;, &#39;&#39;, text_clean_5) #remove trailing s&#39;s 
    text_final = &#39; &#39;.join(text_clean_6.split()) #strip whitespace
    return text_final

#iterate through input corpus, clean, export to new directory 
def export_corpus(input_corpus):
    for d in input_corpus.fileids():
        clean_string = filter_stop_punct(input_corpus.raw(d))
        filename = d
        filepath = os.path.join(export_directory, filename)
        outfile = open(filepath, &#39;w&#39;)
        outfile.write(clean_string)
        outfile.close()
    return &#39;Process complete!&#39;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="corpus-cleaning-in-python.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print the first few lines of the same lecture before and after cleaning </span></span>
<span id="cb19-2"><a href="corpus-cleaning-in-python.html#cb19-2" aria-hidden="true" tabindex="-1"></a>rbma_corpus <span class="op">=</span> PlaintextCorpusReader(<span class="st">&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/rbma-lectures-master/data_no_empty_files_new_file_names_no_intro&#39;</span>, <span class="st">&#39;.*\.txt&#39;</span>)</span>
<span id="cb19-3"><a href="corpus-cleaning-in-python.html#cb19-3" aria-hidden="true" tabindex="-1"></a>rbma_corpus_py_clean_v1 <span class="op">=</span> PlaintextCorpusReader(<span class="st">&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_V1&#39;</span>, <span class="st">&#39;.*\.txt&#39;</span>)</span>
<span id="cb19-4"><a href="corpus-cleaning-in-python.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Raw version:</span><span class="ch">\n</span><span class="st">&#39;</span>, rbma_corpus.raw(<span class="st">&#39;jam-and-lewis.txt&#39;</span>)[<span class="dv">0</span>:<span class="dv">200</span>])</span></code></pre></div>
<pre><code>## Raw version:
##  Jeff Mao
## Our lecturers today are a songwriting and producing team from Minneapolis, Minnesota, that you may have heard of. They happen to be two of the best to have ever done it. So please welcome Jim</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="corpus-cleaning-in-python.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Clean version:</span><span class="ch">\n</span><span class="st">&#39;</span>, rbma_corpus_py_clean_v1.raw(<span class="st">&#39;jam-and-lewis.txt&#39;</span>)[<span class="dv">0</span>:<span class="dv">200</span>])</span></code></pre></div>
<pre><code>## Clean version:
##  lecturers today songwriting producing team minneapolis minnesota may heard happen two best ever done please welcome jimmy jam terry lewis thank thank us yes talk talk would love us listen first reset</code></pre>
<p>The resulting corpus was labelled as RBMA CLEAN PY V1.</p>
<p>I then ran the same function again but this time I did not remove custom stopwords and only removed lecturer and host names when they appeared on new lines, as I felt this might give me an interesting corpus version that still included the key word “music” and didn’t have host and lecturer names as noise but only where they are relevant.</p>
<pre><code>#clean each doc in corpus but no custom stopwords and lecturer and host names only on new lines 
def filter_names(input_string):
    stopwords = nltk.corpus.stopwords.words(&#39;english&#39;) #nltk stopwords 
    lecturer_names = lecturer_names_df[&#39;RBMA stop words&#39;].tolist() #import lecturer/host names 
    cleaning_regex = re.compile(&#39;\n\s*(&#39; + &#39;|&#39;.join(lecturer_names) + &#39;)\s*\n&#39;) #cleaning pattern for names 
    punct_tokenizer = nltk.RegexpTokenizer(r&quot;\w+&quot;) #catch punct at tokenizing stage 
    newline_string = &#39;\n&#39; + input_string #add a new line to catch first mention of lecturer/host
    text_lower = newline_string.lower() #lower everything 
    text_clean = re.sub(cleaning_regex, &#39;\n&#39;, text_lower) #remove names on their own line only
    text_tokenised = punct_tokenizer.tokenize(text_clean) #tokenize string
    text_clean = [w for w in text_tokenised if w not in stopwords] #remove stopwords
    text_clean_2 = TreebankWordDetokenizer().detokenize(text_clean) #detokenize to get clean string back 
    text_clean_3 = re.sub(&#39;’|‘|–|“|”|…|—|dâm funk&#39;, &#39;&#39;, text_clean_2) # catch loose bits
    text_clean_4 = re.sub(r&#39;\d+&#39;, &#39;&#39;, text_clean_3) #remove numbers
    text_clean_5 = re.sub(r&#39;\ss\s&#39;, &#39;&#39;, text_clean_4) #remove trailing s&#39;s 
    text_final = &#39; &#39;.join(text_clean_5.split()) #strip whitespace
    return text_final

#iterate through input corpus, clean, export to new directory 
def export_corpus_names(input_corpus):
    for d in input_corpus.fileids():
        clean_string = filter_names(input_corpus.raw(d))
        filename = d
        filepath = os.path.join(export_directory_two, filename)
        outfile = open(filepath, &#39;w&#39;)
        outfile.write(clean_string)
        outfile.close()
    return &#39;Process complete!&#39;</code></pre>
<p>The resulting corpus was labelled as RBMA CLEAN PY V2.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="corpus-cleaning-in-python.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print the first few lines of the same lecture to show differences btw v1 and v2</span></span>
<span id="cb24-2"><a href="corpus-cleaning-in-python.html#cb24-2" aria-hidden="true" tabindex="-1"></a>rbma_corpus_py_clean_v2 <span class="op">=</span> PlaintextCorpusReader(<span class="st">&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_V2&#39;</span>, <span class="st">&#39;.*\.txt&#39;</span>)</span>
<span id="cb24-3"><a href="corpus-cleaning-in-python.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Python V1:</span><span class="ch">\n</span><span class="st">&#39;</span>, rbma_corpus_py_clean_v1.raw(<span class="st">&#39;jam-and-lewis.txt&#39;</span>)[<span class="dv">0</span>:<span class="dv">300</span>])</span></code></pre></div>
<pre><code>## Python V1:
##  lecturers today songwriting producing team minneapolis minnesota may heard happen two best ever done please welcome jimmy jam terry lewis thank thank us yes talk talk would love us listen first reset clean ears whatever else play actually album produced janet jackson last year cut entitled broken he</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="corpus-cleaning-in-python.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Python V2:</span><span class="ch">\n</span><span class="st">&#39;</span>, rbma_corpus_py_clean_v2.raw(<span class="st">&#39;jam-and-lewis.txt&#39;</span>)[<span class="dv">0</span>:<span class="dv">300</span>])</span></code></pre></div>
<pre><code>## Python V2:
##  lecturers today songwriting producing team minneapolis minnesota may heard happen two best ever done please welcome jimmy jam terry lewis applause thank thank us yes lot music talk lot things talk would love us listen something first reset clean ears whatever else want play something actually album</code></pre>
<hr />
</div>
<div id="lemmatizing-vs-stemming-pt-2" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Lemmatizing vs Stemming pt 2</h2>
<p>For the lemmatizing process in Python I opted to use the WordNetLemmatizer module which is bundled with nltk. The first few tries yielded no changes as I was calling the lemmatizer method directly on the raw strings. I eventually realised I needed to tokenize the raw strings first and then call the method on the tokens before detokenizing the result using nltk’s TreebankWordDetokenizer. The code for this is shown below. <a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></p>
<pre><code>lemmatizer = WordNetLemmatizer()
#lemmatize and export cleaned corpus
def lemma_corpus(input_corpus):
    for d in input_corpus.fileids():
        tokenize_str = word_tokenize(input_corpus.raw(d))
        lemmatized = [lemmatizer.lemmatize(w) for w in tokenize_str]
        detokenise_str = TreebankWordDetokenizer().detokenize(lemmatized)
        filename = d
        filepath = os.path.join(export_directory_three, filename)
        outfile = open(filepath, &#39;w&#39;)
        outfile.write(detokenise_str)
        outfile.close()
    return &#39;Process complete!&#39;</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="corpus-cleaning-in-python.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print the first few lines of the same lecture to show differences btw clean and lemmatized </span></span>
<span id="cb29-2"><a href="corpus-cleaning-in-python.html#cb29-2" aria-hidden="true" tabindex="-1"></a>rbma_corpus_py_clean_lemm_v1 <span class="op">=</span> PlaintextCorpusReader(<span class="st">&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_LEMM_V1&#39;</span>, <span class="st">&#39;.*\.txt&#39;</span>)</span>
<span id="cb29-3"><a href="corpus-cleaning-in-python.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Clean version V1:</span><span class="ch">\n</span><span class="st">&#39;</span>, rbma_corpus_py_clean_v1.raw(<span class="st">&#39;jam-and-lewis.txt&#39;</span>)[<span class="dv">0</span>:<span class="dv">500</span>])</span></code></pre></div>
<pre><code>## Clean version V1:
##  lecturers today songwriting producing team minneapolis minnesota may heard happen two best ever done please welcome jimmy jam terry lewis thank thank us yes talk talk would love us listen first reset clean ears whatever else play actually album produced janet jackson last year cut entitled broken hearts heal jimmy jam terry lewis janet jackson janet jackson broken hearts heal bad huh ok popular songs album popular album successful album story behind every song curious story behind song share us</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="corpus-cleaning-in-python.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Clean and lemmatized version V1:</span><span class="ch">\n</span><span class="st">&#39;</span>, rbma_corpus_py_clean_lemm_v1.raw(<span class="st">&#39;jam-and-lewis.txt&#39;</span>)[<span class="dv">0</span>:<span class="dv">500</span>])</span></code></pre></div>
<pre><code>## Clean and lemmatized version V1:
##  lecturer today songwriting producing team minneapolis minnesota may heard happen two best ever done please welcome jimmy jam terry lewis thank thank u yes talk talk would love u listen first reset clean ear whatever else play actually album produced janet jackson last year cut entitled broken heart heal jimmy jam terry lewis janet jackson janet jackson broken heart heal bad huh ok popular song album popular album successful album story behind every song curious story behind song share u broken h</code></pre>
<p>As we can see the process isn’t full proof, with words like “us” being lemmatized to “u” and verb forms like “produced” not lemmatized to their base lemma. This is a by-product of the default settings of the WordNetLemmatizer and it is possible to further refine the process by using Part Of Speech tagging and custom dictionaries to indicate which terms should be captured and how they should be tagged. Custom dictionaries are quite a bit of work so I skipped them for now but I did tweak the lemmatization function to add baseline POS tagging for adjectives, nouns, verbs, and adverbs. This helped increase the efficiency of the process a little.</p>
<pre><code>def get_wordnet_pos(word):
    &quot;&quot;&quot;Map POS tag to first character lemmatize() accepts&quot;&quot;&quot;
    tag = nltk.pos_tag([word])[0][1][0].upper()
    tag_dict = {&quot;J&quot;: wordnet.ADJ,
                &quot;N&quot;: wordnet.NOUN,
                &quot;V&quot;: wordnet.VERB,
                &quot;R&quot;: wordnet.ADV}

    return tag_dict.get(tag, wordnet.NOUN)

def lemma_pos_corpus(input_corpus):
    for d in input_corpus.fileids():
        tokenize_str = word_tokenize(input_corpus.raw(d))
        lemmatized = [lemmatizer.lemmatize(w, get_wordnet_pos(w)) for w in tokenize_str]
        detokenise_str = TreebankWordDetokenizer().detokenize(lemmatized)
        filename = d
        filepath = os.path.join(export_directory_four, filename)
        outfile = open(filepath, &#39;w&#39;)
        outfile.write(detokenise_str)
        outfile.close()
    return &#39;Process complete!&#39; </code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="corpus-cleaning-in-python.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print the first few lines of the same lecture to show differences btw clean and lemmatized </span></span>
<span id="cb34-2"><a href="corpus-cleaning-in-python.html#cb34-2" aria-hidden="true" tabindex="-1"></a>rbma_corpus_py_clean_lemm_v1_pos <span class="op">=</span> PlaintextCorpusReader(<span class="st">&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_LEMM_V1_POS&#39;</span>, <span class="st">&#39;.*\.txt&#39;</span>)</span>
<span id="cb34-3"><a href="corpus-cleaning-in-python.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Lemmatized version V1:</span><span class="ch">\n</span><span class="st">&#39;</span>, rbma_corpus_py_clean_lemm_v1.raw(<span class="st">&#39;jam-and-lewis.txt&#39;</span>)[<span class="dv">0</span>:<span class="dv">500</span>])</span></code></pre></div>
<pre><code>## Lemmatized version V1:
##  lecturer today songwriting producing team minneapolis minnesota may heard happen two best ever done please welcome jimmy jam terry lewis thank thank u yes talk talk would love u listen first reset clean ear whatever else play actually album produced janet jackson last year cut entitled broken heart heal jimmy jam terry lewis janet jackson janet jackson broken heart heal bad huh ok popular song album popular album successful album story behind every song curious story behind song share u broken h</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="corpus-cleaning-in-python.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Lemmatized with POS V1:</span><span class="ch">\n</span><span class="st">&#39;</span>, rbma_corpus_py_clean_lemm_v1_pos.raw(<span class="st">&#39;jam-and-lewis.txt&#39;</span>)[<span class="dv">0</span>:<span class="dv">500</span>])</span></code></pre></div>
<pre><code>## Lemmatized with POS V1:
##  lecturer today songwriting produce team minneapolis minnesota may heard happen two best ever do please welcome jimmy jam terry lewis thank thank u yes talk talk would love u listen first reset clean ear whatever else play actually album produce janet jackson last year cut entitle broken heart heal jimmy jam terry lewis janet jackson janet jackson broken heart heal bad huh ok popular song album popular album successful album story behind every song curious story behind song share u broken heart h</code></pre>
<p>We can see a slight increase in accuracy, especially with verb forms but we’re still getting issues with “us” and with “heard” not being recognised as a verb form.</p>
<p>The second version of the Python clean corpus was also lemmatized resulting in eight versions of the original raw corpus:</p>
<ul>
<li>R clean v1 (custom stopwords)</li>
<li>R clean v2 (custom stopwords + all lecturer and host names removed)</li>
<li>R clean and lemmatized v1 and v2 (using textstem)</li>
<li>Python clean v1 (custom stopwords as unigrams)</li>
<li>Python clean v2 (no custom stopwords + lecturer and host names removed only from new lines)</li>
<li>Python clean and lemmatized v1 and v2 (using WordNetLemmatizer and POS)</li>
</ul>
<p>Lastly, I ran a quick check on total word counts for each version of the corpus to make sure everything looked ok. Below is the code and the resulting dataframe, which I’d pickled in advance.</p>
<pre><code>#Set corpora roots 

rbma_corpus = PlaintextCorpusReader(&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/rbma-lectures-master/data_no_empty_files_new_file_names_no_intro&#39;, &#39;.*\.txt&#39;)
rbma_corpus_clean_v1 = PlaintextCorpusReader(&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_R_V1&#39;, &#39;.*\.txt&#39;)
rbma_corpus_clean_v2 = PlaintextCorpusReader(&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_R_V2&#39;, &#39;.*\.txt&#39;)
rbma_corpus_clean_lemm_v1 = PlaintextCorpusReader(&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_R_LEMM_V1&#39;, &#39;.*\.txt&#39;)
rbma_corpus_clean_lemm_v2 = PlaintextCorpusReader(&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_R_LEMM_V2&#39;, &#39;.*\.txt&#39;)
rbma_corpus_py_clean_v1 = PlaintextCorpusReader(&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_V1&#39;, &#39;.*\.txt&#39;)
rbma_corpus_py_clean_v2 = PlaintextCorpusReader(&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_V2&#39;, &#39;.*\.txt&#39;)
rbma_corpus_py_clean_lemm_v1 = PlaintextCorpusReader(&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_LEMM_V1_POS&#39;, &#39;.*\.txt&#39;)
rbma_corpus_py_clean_lemm_v2 = PlaintextCorpusReader(&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/RBMA_CLEAN_PY_LEMM_V2_POS&#39;, &#39;.*\.txt&#39;)

#make a list of the corpora and give them pretty titles
rbma_corpus_list = [rbma_corpus, rbma_corpus_clean_v1, rbma_corpus_clean_v2, rbma_corpus_clean_lemm_v1, rbma_corpus_clean_lemm_v2, rbma_corpus_py_clean_v1, rbma_corpus_py_clean_v2, rbma_corpus_py_clean_lemm_v1, rbma_corpus_py_clean_lemm_v2]
title_list = [&#39;RBMA Raw&#39;, &#39;RBMA R V1&#39;, &#39;RBMA R V2&#39;, &#39;RBMA R V1 LEMM&#39;, &#39;RBMA R V2 LEMM&#39;, &#39;RBMA PY V1&#39;, &#39;RBMA PY V2&#39;, &#39;RBMA PY V1 LEMM&#39;, &#39;RBMA PY V2 LEMM&#39;]

#get total length of corpora to compare 
def corpus_lengths(corpus_list):
    total_length = [len(c.words()) for c in corpus_list]
    title = [d for d in title_list]
    length_df = pd.DataFrame({&#39;Corpus&#39;: title, &#39;Length&#39;: total_length}).set_index(&#39;Corpus&#39;)
    return length_df 

corpus_lengths(rbma_corpus_list)</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="corpus-cleaning-in-python.html#cb39-1" aria-hidden="true" tabindex="-1"></a>rbma_corpus_lenghts <span class="op">=</span> <span class="st">&#39;/Users/laurentfintoni/Desktop/University/COURSE DOCS/YEAR 1/Q3/DIGITAL TEXT/PROJECT/PICKLES/corpus_lengths.pkl&#39;</span></span>
<span id="cb39-2"><a href="corpus-cleaning-in-python.html#cb39-2" aria-hidden="true" tabindex="-1"></a>rbma_corpus_lenghts <span class="op">=</span> pd.read_pickle(rbma_corpus_lenghts)</span>
<span id="cb39-3"><a href="corpus-cleaning-in-python.html#cb39-3" aria-hidden="true" tabindex="-1"></a>rbma_corpus_lenghts</span></code></pre></div>
<pre><code>##                   Length
## Corpus                  
## RBMA Raw         6520133
## RBMA R V1        2045574
## RBMA R V2        1963253
## RBMA R V1 LEMM   2045696
## RBMA R V2 LEMM   1963375
## RBMA PY V1       1952929
## RBMA PY V2       2248159
## RBMA PY V1 LEMM  1952837
## RBMA PY V2 LEMM  2248066</code></pre>
<p>By counting all the words in the nltk corpus objects we see a slight increase in total words between the R clean and lemmatized versions, however the Document Term Matrix from <a href="corpus-cleaning-in-r.html#lemmatizing-vs-stemming">2.2</a> confirm that there has been a reduction in unique words. I’m not sure why this increase in total word count happened but assume it might be a by-product of the lemmatizing process creating additional tokens. Aside from this everything looks correct: R V2 has less words due to having removed all host and lecturer names; Python V2 has more words due to not having removed custom stopwords; and the lemmatized versions of the Python corpora have a slightly lesser total word count but a more meaningful drop in unique terms if we inspect their DTM.</p>
<p>I then proceeded forward with three versions of the corpus:</p>
<ol style="list-style-type: decimal">
<li>The raw version, as a benchmark</li>
<li>R V2 LEMM, as a version with the highest amount of custom stopwords and names removed</li>
<li>PY V2 LEMM, as a version with the lowest amount of custom stopwords and names removed</li>
</ol>
<p>Overall, the experience of iteratively cleaning the corpus across both R and Python in a variety of ways really underlined how this is a process that can quickly grow out of hand and needs to be reigned in at some point, as chasing the idea of a perfectly clean corpus can feel like an endless pursuit.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="8">
<li id="fn8"><p><a href="https://www.nltk.org/book/" class="uri">https://www.nltk.org/book/</a><a href="corpus-cleaning-in-python.html#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>The following were used as reference for lemmatizing functions and code: Selva Prabhakaran’s <a href="https://www.machinelearningplus.com/nlp/lemmatization-examples-python/#wordnetlemmatizerwithappropriatepostag">Lemmatization Approaches with Examples in Python</a> and Hafsa Jabeen’s <a href="https://www.datacamp.com/community/tutorials/stemming-lemmatization-python">Stemming and Lemmatization in Python</a><a href="corpus-cleaning-in-python.html#fnref9" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="corpus-cleaning-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploratory-analysis-in-python.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/laurentfintoni/rbma-text-analysis-mining02-corpus_cleaning_py.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
